(()=>{var e={};e.id=4139,e.ids=[4139],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},17816:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>u,serverHooks:()=>m,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{GET:()=>l,POST:()=>h});var i=r(30781),o=r(60554),n=r(31625),s=r(96396);class c{constructor(e){this.config={symbol:"SPY",interval:"5min",...e}}async getCurrentPrice(e=this.config.symbol){try{switch(this.config.provider){case"alpha_vantage":return await this.getAlphaVantagePrice(e);case"finnhub":return await this.getFinnhubPrice(e);case"polygon":return await this.getPolygonPrice(e);case"fmp":return await this.getFMPPrice(e);case"eodhd":return await this.getEODHDPrice(e);default:throw Error(`Unsupported provider: ${this.config.provider}`)}}catch(e){throw console.error("Failed to fetch current price:",e),e}}async getHistoricalData(e=this.config.symbol,t=30){try{switch(this.config.provider){case"alpha_vantage":return await this.getAlphaVantageHistorical(e,t);case"finnhub":return await this.getFinnhubHistorical(e,t);case"polygon":return await this.getPolygonHistorical(e,t);case"fmp":return await this.getFMPHistorical(e,t);case"eodhd":return await this.getEODHDHistorical(e,t);default:throw Error(`Unsupported provider: ${this.config.provider}`)}}catch(e){throw console.error("Failed to fetch historical data:",e),e}}async getAlphaVantagePrice(e){let t=`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${e}&apikey=${this.config.apiKey}`,r=await fetch(t),a=await r.json();if(a["Error Message"])throw Error(`Alpha Vantage error: ${a["Error Message"]}`);let i=a["Global Quote"];return{price:parseFloat(i["05. price"]),change:parseFloat(i["09. change"]),changePercent:parseFloat(i["10. change percent"].replace("%","")),volume:parseInt(i["06. volume"])}}async getAlphaVantageHistorical(e,t){let r=`https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${e}&interval=${this.config.interval}&apikey=${this.config.apiKey}`,a=await fetch(r),i=await a.json();if(i["Error Message"])throw Error(`Alpha Vantage error: ${i["Error Message"]}`);let o=i[`Time Series (${this.config.interval})`],n=[];for(let[r,a]of Object.entries(o))if(n.push({price:parseFloat(a["4. close"]),volume:parseInt(a["5. volume"]),timestamp:new Date(r).toISOString(),high:parseFloat(a["2. high"]),low:parseFloat(a["3. low"]),open:parseFloat(a["1. open"]),symbol:e}),n.length>=78*t)break;return n.reverse()}async getFinnhubPrice(e){let t=`https://finnhub.io/api/v1/quote?symbol=${e}&token=${this.config.apiKey}`,r=await fetch(t),a=await r.json();if(a.error)throw Error(`Finnhub error: ${a.error}`);return{price:a.c,change:a.d,changePercent:a.dp,volume:a.v||0}}async getFinnhubHistorical(e,t){let r=Math.floor(Date.now()/1e3),a=`https://finnhub.io/api/v1/stock/candle?symbol=${e}&resolution=5&from=${r-24*t*3600}&to=${r}&token=${this.config.apiKey}`,i=await fetch(a),o=await i.json();if("ok"!==o.s)throw Error(`Finnhub error: ${o.s}`);let n=[];for(let t=0;t<o.c.length;t++)n.push({price:o.c[t],volume:o.v[t],timestamp:new Date(1e3*o.t[t]).toISOString(),high:o.h[t],low:o.l[t],open:o.o[t],symbol:e});return n}async getPolygonPrice(e){let t=`https://api.polygon.io/v2/last/trade/${e}?apikey=${this.config.apiKey}`,r=await fetch(t),a=await r.json();if("OK"!==a.status)throw Error(`Polygon error: ${a.error||"Unknown error"}`);let i=`https://api.polygon.io/v2/aggs/ticker/${e}/prev?adjusted=true&apikey=${this.config.apiKey}`,o=await fetch(i),n=await o.json(),s=a.results.p,c=n.results?.[0]?.c||s,p=s-c;return{price:s,change:p,changePercent:p/c*100,volume:a.results.s||0}}async getPolygonHistorical(e,t){let r=new Date().toISOString().split("T")[0],a=new Date(Date.now()-24*t*36e5).toISOString().split("T")[0],i=`https://api.polygon.io/v2/aggs/ticker/${e}/range/5/minute/${a}/${r}?adjusted=true&sort=asc&apikey=${this.config.apiKey}`,o=await fetch(i),n=await o.json();if("OK"!==n.status)throw Error(`Polygon error: ${n.error||"Unknown error"}`);return n.results.map(t=>({price:t.c,volume:t.v,timestamp:new Date(t.t).toISOString(),high:t.h,low:t.l,open:t.o,symbol:e}))}async getFMPPrice(e){let t=`https://financialmodelingprep.com/api/v3/quote/${e}?apikey=${this.config.apiKey}`,r=await fetch(t),a=await r.json();if(!a||0===a.length)throw Error("FMP: No data received");let i=a[0];return{price:i.price,change:i.change,changePercent:i.changesPercentage,volume:i.volume}}async getFMPHistorical(e,t){let r=`https://financialmodelingprep.com/api/v3/historical-chart/5min/${e}?apikey=${this.config.apiKey}`,a=await fetch(r),i=await a.json();if(!Array.isArray(i))throw Error("FMP: Invalid response format");return i.slice(0,78*t).reverse().map(t=>({price:t.close,volume:t.volume,timestamp:new Date(t.date).toISOString(),high:t.high,low:t.low,open:t.open,symbol:e}))}async getEODHDPrice(e){let t=`https://eodhd.com/api/real-time/${e}?api_token=${this.config.apiKey}&fmt=json`,r=await fetch(t),a=await r.json();if(a.error)throw Error(`EODHD error: ${a.error}`);return{price:a.close,change:a.change,changePercent:a.change_p,volume:a.volume||0}}async getEODHDHistorical(e,t){let r=new Date().toISOString().split("T")[0],a=new Date(Date.now()-24*t*36e5).toISOString().split("T")[0],i=`https://eodhd.com/api/intraday/${e}?api_token=${this.config.apiKey}&interval=5m&from=${a}&to=${r}&fmt=json`,o=await fetch(i),n=await o.json();if(!Array.isArray(n))throw Error("EODHD: Invalid response format");return n.map(t=>({price:t.close,volume:t.volume,timestamp:new Date(`${t.datetime}Z`).toISOString(),high:t.high,low:t.low,open:t.open,symbol:e}))}}let p={ALPHA_VANTAGE:{name:"Alpha Vantage",freeLimit:"100 requests/day",features:["Real-time","Historical","Technical indicators"],signupUrl:"https://www.alphavantage.co/support/#api-key"},FINNHUB:{name:"Finnhub",freeLimit:"60 calls/minute",features:["Real-time","Company fundamentals","Alternative data"],signupUrl:"https://finnhub.io/register"},POLYGON:{name:"Polygon.io",freeLimit:"5 calls/minute",features:["Real-time","Options data","News"],signupUrl:"https://polygon.io/pricing"},FMP:{name:"Financial Modeling Prep",freeLimit:"250 requests/day",features:["Financial statements","Real-time prices","Ratios"],signupUrl:"https://site.financialmodelingprep.com/developer/docs"},EODHD:{name:"EODHD",freeLimit:"20 requests/day",features:["End-of-day data","Intraday","Options"],signupUrl:"https://eodhd.com/register"}};async function l(e){let t=e.nextUrl.searchParams,r=t.get("symbol")||"SPY",a=t.get("provider")||"alpha_vantage",i=t.get("type")||"current",o=parseInt(t.get("days")||"7"),n=function(e){switch(e){case"alpha_vantage":return process.env.ALPHA_VANTAGE_API_KEY;case"finnhub":return process.env.FINNHUB_API_KEY;case"polygon":return process.env.POLYGON_API_KEY;case"fmp":return process.env.FMP_API_KEY;case"eodhd":return process.env.EODHD_API_KEY;default:return}}(a);if(!n)return s.NextResponse.json({error:`API key not configured for provider: ${a}`,providers:p,message:"Please set up API keys in environment variables"},{status:400});try{var l;let e=(l={provider:a,apiKey:n,symbol:r,interval:"5min"},new c(l));if("current"===i){let t=await e.getCurrentPrice(r);return s.NextResponse.json({success:!0,data:t,provider:a,symbol:r,timestamp:new Date().toISOString()})}if("historical"!==i)return s.NextResponse.json({error:'Invalid type parameter. Use "current" or "historical"'},{status:400});{let t=await e.getHistoricalData(r,o);return s.NextResponse.json({success:!0,data:t,provider:a,symbol:r,days:o,count:t.length,timestamp:new Date().toISOString()})}}catch(e){return console.error("Market data API error:",e),s.NextResponse.json({error:"Failed to fetch market data",message:e instanceof Error?e.message:"Unknown error",provider:a,symbol:r},{status:500})}}async function h(){return s.NextResponse.json({message:"Market Data API",endpoints:{"GET /api/market-data":{description:"Get current or historical market data",parameters:{symbol:"Stock symbol (default: SPY)",provider:"Data provider (alpha_vantage, finnhub, polygon, fmp, eodhd)",type:"Data type (current, historical)",days:"Days of historical data (default: 7)"}}},providers:p,examples:{current:"/api/market-data?symbol=AAPL&provider=alpha_vantage&type=current",historical:"/api/market-data?symbol=SPY&provider=finnhub&type=historical&days=30"}})}let u=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/market-data/route",pathname:"/api/market-data",filename:"route",bundlePath:"app/api/market-data/route"},resolvedPagePath:"/workspaces/virtual-options-desk/frontend/src/app/api/market-data/route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:g,workUnitAsyncStorage:d,serverHooks:m}=u;function f(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:d})}},24429:()=>{},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64749:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9683,9146],()=>r(17816));module.exports=a})();