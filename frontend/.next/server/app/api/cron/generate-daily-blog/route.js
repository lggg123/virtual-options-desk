(()=>{var e={};e.id=3021,e.ids=[3021],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11384:(e,t,s)=>{"use strict";let n,r,i,a;s.r(t),s.d(t,{patchFetch:()=>nC,routeModule:()=>nI,serverHooks:()=>nP,workAsyncStorage:()=>nR,workUnitAsyncStorage:()=>nE});var o,l,c,u,h,d,p,f,m,g,y,w,_,b,v,x,S,$,A,k,O,I,R,E,P,C,T,N,j,M,L,D,B,q,W,U,F,X,J,H,K,V,z,Y,Q,G,Z,ee,et,es,en,er,ei,ea,eo,el,ec,eu,eh,ed,ep,ef,em,eg,ey,ew,e_,eb,ev,ex,eS,e$,eA,ek,eO,eI,eR={};s.r(eR),s.d(eR,{GET:()=>nk,POST:()=>nO});var eE=s(30781),eP=s(60554),eC=s(31625),eT=s(96396);function eN(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function ej(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let eM=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eM=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function eL(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eD=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eB extends Error{}class eq extends eB{constructor(e,t,s,n){super(`${eq.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new eU({message:s,cause:eD(t)});let r=t?.error;return 400===e?new eX(e,r,s,n):401===e?new eJ(e,r,s,n):403===e?new eH(e,r,s,n):404===e?new eK(e,r,s,n):409===e?new eV(e,r,s,n):422===e?new ez(e,r,s,n):429===e?new eY(e,r,s,n):e>=500?new eQ(e,r,s,n):new eq(e,r,s,n)}}class eW extends eq{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eU extends eq{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eF extends eU{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eX extends eq{}class eJ extends eq{}class eH extends eq{}class eK extends eq{}class eV extends eq{}class ez extends eq{}class eY extends eq{}class eQ extends eq{}class eG extends eB{constructor(){super("Could not parse response content as the length limit was reached")}}class eZ extends eB{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class e0 extends Error{constructor(e){super(e)}}let e1=/^[a-z][a-z0-9+.-]*:/i,e2=e=>e1.test(e),e4=e=>(e4=Array.isArray)(e),e3=e4;function e6(e){return"object"!=typeof e?{}:e??{}}function e8(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e5=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eB(`${e} must be an integer`);if(t<0)throw new eB(`${e} must be a positive integer`);return t},e9=e=>{try{return JSON.parse(e)}catch(e){return}},e7=e=>new Promise(t=>setTimeout(t,e)),te="6.9.1",tt=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,ts=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":tr(Deno.build.os),"X-Stainless-Arch":tn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":tr(globalThis.process.platform??"unknown"),"X-Stainless-Arch":tn(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},tn=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",tr=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",ti=()=>n??(n=ts());function ta(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function to(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return ta({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function tl(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tc(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let tu=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),th="RFC3986",td=e=>String(e),tp={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:td},tf=(e,t)=>(tf=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),tm=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tg(e,t){if(e4(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let ty={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},tw=function(e,t){Array.prototype.push.apply(e,e4(t)?t:[t])},t_={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tm[n];continue}if(n<2048){s[s.length]=tm[192|n>>6]+tm[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tm[224|n>>12]+tm[128|n>>6&63]+tm[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tm[240|n>>18]+tm[128|n>>12&63]+tm[128|n>>6&63]+tm[128|63&n]}a+=s.join("")}return a},encodeValuesOnly:!1,format:th,formatter:td,indices:!1,serializeDate:e=>(r??(r=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tb={};function tv(e){let t;return(i??(i=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tx(e){let t;return(a??(a=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class tS{constructor(){o.set(this,void 0),l.set(this,void 0),eN(this,o,new Uint8Array,"f"),eN(this,l,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tv(e):e;eN(this,o,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([ej(this,o,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(ej(this,o,"f"),ej(this,l,"f")));){if(t.carriage&&null==ej(this,l,"f")){eN(this,l,t.index,"f");continue}if(null!=ej(this,l,"f")&&(t.index!==ej(this,l,"f")+1||t.carriage)){n.push(tx(ej(this,o,"f").subarray(0,ej(this,l,"f")-1))),eN(this,o,ej(this,o,"f").subarray(ej(this,l,"f")),"f"),eN(this,l,null,"f");continue}let e=null!==ej(this,l,"f")?t.preceding-1:t.preceding,s=tx(ej(this,o,"f").subarray(0,e));n.push(s),eN(this,o,ej(this,o,"f").subarray(t.index),"f"),eN(this,l,null,"f")}return n}flush(){return ej(this,o,"f").length?this.decode("\n"):[]}}o=new WeakMap,l=new WeakMap,tS.NEWLINE_CHARS=new Set(["\n","\r"]),tS.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let t$={off:0,error:200,warn:300,info:400,debug:500},tA=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(t$,e))return e;tE(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(t$))}`)}};function tk(){}function tO(e,t,s){return!t||t$[e]>t$[s]?tk:t[e].bind(t)}let tI={error:tk,warn:tk,info:tk,debug:tk},tR=new WeakMap;function tE(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tI;let n=tR.get(t);if(n&&n[0]===s)return n[1];let r={error:tO("error",t,s),warn:tO("warn",t,s),info:tO("info",t,s),debug:tO("debug",t,s)};return tR.set(t,[s,r]),r}let tP=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tC{constructor(e,t,s){this.iterator=e,c.set(this,void 0),this.controller=t,eN(this,c,s,"f")}static fromSSEResponse(e,t,s){let n=!1,r=s?tE(s):console;async function*i(){if(n)throw new eB("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(let n of tT(e,t))if(!s){if(n.data.startsWith("[DONE]")){s=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new eq(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw r.error("Could not parse message into JSON:",n.data),r.error("From chunk:",n.raw),e}if(t&&t.error)throw new eq(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(eL(e))return;throw e}finally{s||t.abort()}}return new tC(i,t,s)}static fromReadableStream(e,t,s){let n=!1;async function*r(){let t=new tS;for await(let s of tl(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tC(async function*(){if(n)throw new eB("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eL(e))return;throw e}finally{e||t.abort()}},t,s)}[(c=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tC(()=>n(e),this.controller,ej(this,c,"f")),new tC(()=>n(t),this.controller,ej(this,c,"f"))]}toReadableStream(){let e,t=this;return ta({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tv(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tT(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eB("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eB("Attempted to iterate over a response with no body")}let s=new tj,n=new tS;for await(let t of tN(tl(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tN(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tv(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tj{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function tM(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tE(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):tC.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tL(await s.json(),s):await s.text()})();return tE(e).debug(`[${n}] response parsed`,tP({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tL(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tD extends Promise{constructor(e,t,s=tM){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,u.set(this,void 0),eN(this,u,e,"f")}_thenUnwrap(e){return new tD(ej(this,u,"f"),this.responsePromise,async(t,s)=>tL(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(ej(this,u,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}u=new WeakMap;class tB{constructor(e,t,s,n){h.set(this,void 0),eN(this,h,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eB("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await ej(this,h,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(h=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tq extends tD{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tM(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tW extends tB{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tU extends tB{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...e6(this.options.query),after:t}}:null}}class tF extends tB{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...e6(this.options.query),after:e}}:null}}let tX=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tJ(e,t,s){return tX(),new File(e,t??"unknown_file",s)}function tH(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tK=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tV=async(e,t)=>t0(e.body)?{...e,body:await tQ(e.body,t)}:e,tz=async(e,t)=>({...e,body:await tQ(e.body,t)}),tY=new WeakMap,tQ=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tY.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tY.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>t1(s,e,t))),s},tG=e=>e instanceof Blob&&"name"in e,tZ=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tK(e)||tG(e)),t0=e=>{if(tZ(e))return!0;if(Array.isArray(e))return e.some(t0);if(e&&"object"==typeof e){for(let t in e)if(t0(e[t]))return!0}return!1},t1=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tJ([await s.blob()],tH(s)));else if(tK(s))e.append(t,tJ([await new Response(to(s)).blob()],tH(s)));else if(tG(s))e.append(t,s,tH(s));else if(Array.isArray(s))await Promise.all(s.map(s=>t1(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>t1(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},t2=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,t4=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&t2(e),t3=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function t6(e,t,s){if(tX(),t4(e=await e))return e instanceof File?e:tJ([await e.arrayBuffer()],e.name);if(t3(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tJ(await t8(n),t,s)}let n=await t8(e);if(t||(t=tH(e)),!s?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tJ(n,t,s)}async function t8(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(t2(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tK(e))for await(let s of e)t.push(...await t8(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class t5{constructor(e){this._client=e}}function t9(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let t7=Object.freeze(Object.create(null)),se=((e=t9)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,i=[],a=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(r=!0);let o=s[a],l=(r?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??t7)??t7)?.toString)&&(l=o+"",i.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)i.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eB(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(t9);class st extends t5{list(e,t={},s){return this._client.getAPIList(se`/chat/completions/${e}/messages`,tU,{query:t,...s})}}function ss(e){return void 0!==e&&"function"in e&&void 0!==e.function}function sn(e){return e?.$brand==="auto-parseable-response-format"}function sr(e){return e?.$brand==="auto-parseable-tool"}function si(e,t){let s=e.choices.map(e=>{var s,n;if("length"===e.finish_reason)throw new eG;if("content_filter"===e.finish_reason)throw new eZ;return so(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>ss(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:sr(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,n=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...e,choices:s}}function sa(e){return!!sn(e.response_format)||(e.tools?.some(e=>sr(e)||"function"===e.type&&!0===e.function.strict)??!1)}function so(e){for(let t of e||[])if("function"!==t.type)throw new eB(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let sl=e=>e?.role==="assistant",sc=e=>e?.role==="tool";class su{constructor(){d.add(this),this.controller=new AbortController,p.set(this,void 0),f.set(this,()=>{}),m.set(this,()=>{}),g.set(this,void 0),y.set(this,()=>{}),w.set(this,()=>{}),_.set(this,{}),b.set(this,!1),v.set(this,!1),x.set(this,!1),S.set(this,!1),eN(this,p,new Promise((e,t)=>{eN(this,f,e,"f"),eN(this,m,t,"f")}),"f"),eN(this,g,new Promise((e,t)=>{eN(this,y,e,"f"),eN(this,w,t,"f")}),"f"),ej(this,p,"f").catch(()=>{}),ej(this,g,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ej(this,d,"m",$).bind(this))},0)}_connected(){this.ended||(ej(this,f,"f").call(this),this._emit("connect"))}get ended(){return ej(this,b,"f")}get errored(){return ej(this,v,"f")}get aborted(){return ej(this,x,"f")}abort(){this.controller.abort()}on(e,t){return(ej(this,_,"f")[e]||(ej(this,_,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ej(this,_,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(ej(this,_,"f")[e]||(ej(this,_,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eN(this,S,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eN(this,S,!0,"f"),await ej(this,g,"f")}_emit(e,...t){if(ej(this,b,"f"))return;"end"===e&&(eN(this,b,!0,"f"),ej(this,y,"f").call(this));let s=ej(this,_,"f")[e];if(s&&(ej(this,_,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ej(this,S,"f")||s?.length||Promise.reject(e),ej(this,m,"f").call(this,e),ej(this,w,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ej(this,S,"f")||s?.length||Promise.reject(e),ej(this,m,"f").call(this,e),ej(this,w,"f").call(this,e),this._emit("end")}}_emitFinal(){}}p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,x=new WeakMap,S=new WeakMap,d=new WeakSet,$=function(e){if(eN(this,v,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eW),e instanceof eW)return eN(this,x,!0,"f"),this._emit("abort",e);if(e instanceof eB)return this._emit("error",e);if(e instanceof Error){let t=new eB(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eB(String(e)))};class sh extends su{constructor(){super(...arguments),A.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),sc(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(sl(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eB("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ej(this,A,"m",k).call(this)}async finalMessage(){return await this.done(),ej(this,A,"m",O).call(this)}async finalFunctionToolCall(){return await this.done(),ej(this,A,"m",I).call(this)}async finalFunctionToolCallResult(){return await this.done(),ej(this,A,"m",R).call(this)}async totalUsage(){return await this.done(),ej(this,A,"m",E).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=ej(this,A,"m",O).call(this);t&&this._emit("finalMessage",t);let s=ej(this,A,"m",k).call(this);s&&this._emit("finalContent",s);let n=ej(this,A,"m",I).call(this);n&&this._emit("finalFunctionToolCall",n);let r=ej(this,A,"m",R).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",ej(this,A,"m",E).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ej(this,A,"m",P).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(si(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:i,...a}=t,o="string"!=typeof r&&"function"===r.type&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(sr(e)){if(!e.$callback)throw new eB("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let h="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:h,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eB("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:i}=e.function,a=u[r];if(a){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=ej(this,A,"m",C).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}A=new WeakSet,k=function(){return ej(this,A,"m",O).call(this).content??null},O=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(sl(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eB("stream ended without producing a ChatCompletionMessage with role=assistant")},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sl(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},R=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sc(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},E=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},P=function(e){if(null!=e.n&&e.n>1)throw new eB("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},C=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class sd extends sh{static runTools(e,t,s){let n=new sd,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),sl(e)&&e.content&&this._emit("content",e.content)}}let sp={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sf extends Error{}class sm extends Error{}let sg=(e,t)=>{let s=e.length,n=0,r=e=>{throw new sf(`${e} at position ${n}`)},i=e=>{throw new sm(`${e} at position ${n}`)},a=()=>(h(),n>=s&&r("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||sp.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||sp.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||sp.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||sp.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||sp.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||sp.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u(),o=()=>{let a=n,o=!1;for(n++;n<s&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(o)))}catch(e){i(String(e))}else if(sp.STR&t)try{return JSON.parse(e.substring(a,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,h();let i={};try{for(;"}"!==e[n];){if(h(),n>=s&&sp.OBJ&t)return i;let r=o();h(),n++;try{let e=a();Object.defineProperty(i,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sp.OBJ&t)return i;throw e}h(),","===e[n]&&n++}}catch(e){if(sp.OBJ&t)return i;r("Expected '}' at end of object")}return n++,i},c=()=>{n++;let s=[];try{for(;"]"!==e[n];)s.push(a()),h(),","===e[n]&&n++}catch(e){if(sp.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&sp.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sp.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||sp.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(s){"-"===e.substring(a,n)&&sp.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},h=()=>{for(;n<s&&" \n\r	".includes(e[n]);)n++};return a()},sy=e=>(function(e,t=sp.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sg(e.trim(),t)})(e,sp.ALL^sp.NUM);class sw extends sh{constructor(e){super(),T.add(this),N.set(this,void 0),j.set(this,void 0),M.set(this,void 0),eN(this,N,e,"f"),eN(this,j,[],"f")}get currentChatCompletionSnapshot(){return ej(this,M,"f")}static fromReadableStream(e){let t=new sw(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new sw(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ej(this,T,"m",L).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))ej(this,T,"m",B).call(this,e);if(r.controller.signal?.aborted)throw new eW;return this._addChatCompletion(ej(this,T,"m",U).call(this))}async _fromReadableStream(e,t){let s,n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ej(this,T,"m",L).call(this),this._connected();let r=tC.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(ej(this,T,"m",U).call(this)),ej(this,T,"m",B).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eW;return this._addChatCompletion(ej(this,T,"m",U).call(this))}[(N=new WeakMap,j=new WeakMap,M=new WeakMap,T=new WeakSet,L=function(){this.ended||eN(this,M,void 0,"f")},D=function(e){let t=ej(this,j,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ej(this,j,"f")[e.index]=t),t},B=function(e){if(this.ended)return;let t=ej(this,T,"m",X).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=ej(this,T,"m",D).call(this,e);for(let t of(e.finish_reason&&(ej(this,T,"m",W).call(this,e),null!=n.current_tool_call_index&&ej(this,T,"m",q).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(ej(this,T,"m",W).call(this,e),null!=n.current_tool_call_index&&ej(this,T,"m",q).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},q=function(e,t){if(ej(this,T,"m",D).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=ej(this,N,"f")?.tools?.find(e=>ss(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:sr(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},W=function(e){let t=ej(this,T,"m",D).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=ej(this,T,"m",F).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},U=function(){if(this.ended)throw new eB("stream has ended, this shouldn't happen");let e=ej(this,M,"f");if(!e)throw new eB("request ended without sending any chunks");return eN(this,M,void 0,"f"),eN(this,j,[],"f"),function(e,t){var s;let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new eB(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new eB(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eB(`missing function_call.arguments for choice ${n}`);if(!l)throw new eB(`missing function_call.name for choice ${n}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...i,index:n,finish_reason:s,logprobs:r,message:{...c,role:u,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:i,id:a,...o}=t,{arguments:l,name:c,...u}=r||{};if(null==a)throw new eB(`missing choices[${n}].tool_calls[${s}].id
${s_(e)}`);if(null==i)throw new eB(`missing choices[${n}].tool_calls[${s}].type
${s_(e)}`);if(null==c)throw new eB(`missing choices[${n}].tool_calls[${s}].function.name
${s_(e)}`);if(null==l)throw new eB(`missing choices[${n}].tool_calls[${s}].function.arguments
${s_(e)}`);return{...o,id:a,type:i,function:{...u,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&sa(t)?si(s,t):{...s,choices:s.choices.map(e=>(so(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,ej(this,N,"f"))},F=function(){let e=ej(this,N,"f")?.response_format;return sn(e)?e:null},X=function(e){var t,s,n,r;let i=ej(this,M,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:u=null,...h}of(i?Object.assign(i,o):i=eN(this,M,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...h}),u)if(e.logprobs){let{content:n,refusal:r,...i}=u;Object.assign(e.logprobs,i),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},u);if(l&&(e.finish_reason=l,ej(this,N,"f")&&sa(ej(this,N,"f")))){if("length"===l)throw new eG;if("content_filter"===l)throw new eZ}if(Object.assign(e,h),!a)continue;let{content:o,refusal:d,function_call:p,role:f,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&ej(this,T,"m",F).call(this)&&(e.message.parsed=sy(e.message.content))),m)for(let{index:t,id:s,type:n,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,a),s&&(o.id=s),n&&(o.type=n),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>ss(e)&&e.function?.name===t.function.name);return ss(s)&&(sr(s)||s?.function.strict||!1)}(ej(this,N,"f"),o)&&(o.function.parsed_arguments=sy(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tC(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function s_(e){return JSON.stringify(e)}class sb extends sw{static fromReadableStream(e){let t=new sb(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new sb(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sv extends t5{constructor(){super(...arguments),this.messages=new st(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(se`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(se`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tU,{query:e,...t})}delete(e,t){return this._client.delete(se`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new eB(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eB(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>si(t,e))}runTools(e,t){return e.stream?sb.runTools(this._client,e,t):sd.runTools(this._client,e,t)}stream(e,t){return sw.createChatCompletion(this._client,e,t)}}sv.Messages=st;class sx extends t5{constructor(){super(...arguments),this.completions=new sv(this._client)}}sx.Completions=sv;let sS=Symbol("brand.privateNullableHeaders"),s$=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,i]of function*(e){let t;if(!e)return;if(sS in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():e3(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=e3(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[sS]:!0,values:t,nulls:s}};class sA extends t5{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:s$([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sk extends t5{create(e,t){return this._client.post("/audio/transcriptions",tz({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sO extends t5{create(e,t){return this._client.post("/audio/translations",tz({body:e,...t,__metadata:{model:e.model}},this._client))}}class sI extends t5{constructor(){super(...arguments),this.transcriptions=new sk(this._client),this.translations=new sO(this._client),this.speech=new sA(this._client)}}sI.Transcriptions=sk,sI.Translations=sO,sI.Speech=sA;class sR extends t5{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(se`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tU,{query:e,...t})}cancel(e,t){return this._client.post(se`/batches/${e}/cancel`,t)}}class sE extends t5{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(se`/assistants/${e}`,{...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(se`/assistants/${e}`,{body:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tU,{query:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(se`/assistants/${e}`,{...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sP extends t5{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sC extends t5{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sT extends t5{constructor(){super(...arguments),this.sessions=new sP(this._client),this.transcriptionSessions=new sC(this._client)}}sT.Sessions=sP,sT.TranscriptionSessions=sC;class sN extends t5{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:s$([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(se`/chatkit/sessions/${e}/cancel`,{...t,headers:s$([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class sj extends t5{retrieve(e,t){return this._client.get(se`/chatkit/threads/${e}`,{...t,headers:s$([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",tF,{query:e,...t,headers:s$([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(se`/chatkit/threads/${e}`,{...t,headers:s$([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList(se`/chatkit/threads/${e}/items`,tF,{query:t,...s,headers:s$([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}class sM extends t5{constructor(){super(...arguments),this.sessions=new sN(this._client),this.threads=new sj(this._client)}}sM.Sessions=sN,sM.Threads=sj;class sL extends t5{create(e,t,s){return this._client.post(se`/threads/${e}/messages`,{body:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(se`/threads/${n}/messages/${e}`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(se`/threads/${n}/messages/${e}`,{body:r,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(se`/threads/${e}/messages`,tU,{query:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(se`/threads/${n}/messages/${e}`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sD extends t5{retrieve(e,t,s){let{thread_id:n,run_id:r,...i}=t;return this._client.get(se`/threads/${n}/runs/${r}/steps/${e}`,{query:i,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(se`/threads/${n}/runs/${e}/steps`,tU,{query:r,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sB=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}},sq=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sW extends su{constructor(){super(...arguments),J.add(this),K.set(this,[]),V.set(this,{}),z.set(this,{}),Y.set(this,void 0),Q.set(this,void 0),G.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0),en.set(this,void 0),er.set(this,void 0)}[(K=new WeakMap,V=new WeakMap,z=new WeakMap,Y=new WeakMap,Q=new WeakMap,G=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,en=new WeakMap,er=new WeakMap,J=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new H;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tC.fromReadableStream(e,this.controller);for await(let e of n)ej(this,J,"m",ei).call(this,e);if(n.controller.signal?.aborted)throw new eW;return this._addRun(ej(this,J,"m",ea).call(this))}toReadableStream(){return new tC(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))ej(this,J,"m",ei).call(this,e);if(a.controller.signal?.aborted)throw new eW;return this._addRun(ej(this,J,"m",ea).call(this))}static createThreadAssistantStream(e,t,s){let n=new H;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return ej(this,es,"f")}currentRun(){return ej(this,en,"f")}currentMessageSnapshot(){return ej(this,Y,"f")}currentRunStepSnapshot(){return ej(this,er,"f")}async finalRunSteps(){return await this.done(),Object.values(ej(this,V,"f"))}async finalMessages(){return await this.done(),Object.values(ej(this,z,"f"))}async finalRun(){if(await this.done(),!ej(this,Q,"f"))throw Error("Final run was not received.");return ej(this,Q,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))ej(this,J,"m",ei).call(this,e);if(i.controller.signal?.aborted)throw new eW;return this._addRun(ej(this,J,"m",ea).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))ej(this,J,"m",ei).call(this,e);if(a.controller.signal?.aborted)throw new eW;return this._addRun(ej(this,J,"m",ea).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(e8(t)&&e8(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!e8(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}H=sW,ei=function(e){if(!this.ended)switch(eN(this,es,e,"f"),ej(this,J,"m",ec).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ej(this,J,"m",ep).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ej(this,J,"m",el).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ej(this,J,"m",eo).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ea=function(){if(this.ended)throw new eB("stream has ended, this shouldn't happen");if(!ej(this,Q,"f"))throw Error("Final run has not been received");return ej(this,Q,"f")},eo=function(e){let[t,s]=ej(this,J,"m",eh).call(this,e,ej(this,Y,"f"));for(let e of(eN(this,Y,t,"f"),ej(this,z,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=ej(this,G,"f")){if(ej(this,Z,"f"))switch(ej(this,Z,"f").type){case"text":this._emit("textDone",ej(this,Z,"f").text,ej(this,Y,"f"));break;case"image_file":this._emit("imageFileDone",ej(this,Z,"f").image_file,ej(this,Y,"f"))}eN(this,G,s.index,"f")}eN(this,Z,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==ej(this,G,"f")){let t=e.data.content[ej(this,G,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,ej(this,Y,"f"));break;case"text":this._emit("textDone",t.text,ej(this,Y,"f"))}}ej(this,Y,"f")&&this._emit("messageDone",e.data),eN(this,Y,void 0,"f")}},el=function(e){let t=ej(this,J,"m",eu).call(this,e);switch(eN(this,er,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==ej(this,ee,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(ej(this,et,"f")&&this._emit("toolCallDone",ej(this,et,"f")),eN(this,ee,e.index,"f"),eN(this,et,t.step_details.tool_calls[e.index],"f"),ej(this,et,"f")&&this._emit("toolCallCreated",ej(this,et,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eN(this,er,void 0,"f"),"tool_calls"==e.data.step_details.type&&ej(this,et,"f")&&(this._emit("toolCallDone",ej(this,et,"f")),eN(this,et,void 0,"f")),this._emit("runStepDone",e.data,t)}},ec=function(e){ej(this,K,"f").push(e),this._emit("event",e)},eu=function(e){switch(e.event){case"thread.run.step.created":return ej(this,V,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=ej(this,V,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=H.accumulateDelta(t,s.delta);ej(this,V,"f")[e.data.id]=n}return ej(this,V,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ej(this,V,"f")[e.data.id]=e.data}if(ej(this,V,"f")[e.data.id])return ej(this,V,"f")[e.data.id];throw Error("No snapshot available")},eh=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=ej(this,J,"m",ed).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ed=function(e,t){return H.accumulateDelta(t,e)},ep=function(e){switch(eN(this,en,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eN(this,Q,e.data,"f"),ej(this,et,"f")&&(this._emit("toolCallDone",ej(this,et,"f")),eN(this,et,void 0,"f"))}};class sU extends t5{constructor(){super(...arguments),this.steps=new sD(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(se`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(se`/threads/${n}/runs/${e}`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(se`/threads/${n}/runs/${e}`,{body:r,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(se`/threads/${e}/runs`,tU,{query:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(se`/threads/${n}/runs/${e}/cancel`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sW.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=s$([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e7(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sW.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(se`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sW.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sU.Steps=sD;class sF extends t5{constructor(){super(...arguments),this.runs=new sU(this._client),this.messages=new sL(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(se`/threads/${e}`,{...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(se`/threads/${e}`,{body:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(se`/threads/${e}`,{...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sW.createThreadAssistantStream(e,this._client.beta.threads,t)}}sF.Runs=sU,sF.Messages=sL;class sX extends t5{constructor(){super(...arguments),this.realtime=new sT(this._client),this.chatkit=new sM(this._client),this.assistants=new sE(this._client),this.threads=new sF(this._client)}}sX.Realtime=sT,sX.ChatKit=sM,sX.Assistants=sE,sX.Threads=sF;class sJ extends t5{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sH extends t5{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(se`/containers/${n}/files/${e}/content`,{...s,headers:s$([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sK extends t5{constructor(){super(...arguments),this.content=new sH(this._client)}create(e,t,s){return this._client.post(se`/containers/${e}/files`,tz({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(se`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(se`/containers/${e}/files`,tU,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(se`/containers/${n}/files/${e}`,{...s,headers:s$([{Accept:"*/*"},s?.headers])})}}sK.Content=sH;class sV extends t5{constructor(){super(...arguments),this.files=new sK(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(se`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tU,{query:e,...t})}delete(e,t){return this._client.delete(se`/containers/${e}`,{...t,headers:s$([{Accept:"*/*"},t?.headers])})}}sV.Files=sK;class sz extends t5{create(e,t,s){let{include:n,...r}=t;return this._client.post(se`/conversations/${e}/items`,{query:{include:n},body:r,...s})}retrieve(e,t,s){let{conversation_id:n,...r}=t;return this._client.get(se`/conversations/${n}/items/${e}`,{query:r,...s})}list(e,t={},s){return this._client.getAPIList(se`/conversations/${e}/items`,tF,{query:t,...s})}delete(e,t,s){let{conversation_id:n}=t;return this._client.delete(se`/conversations/${n}/items/${e}`,s)}}class sY extends t5{constructor(){super(...arguments),this.items=new sz(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(se`/conversations/${e}`,t)}update(e,t,s){return this._client.post(se`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(se`/conversations/${e}`,t)}}sY.Items=sz;class sQ extends t5{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tE(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tE(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=sB(t)}),e)))}}class sG extends t5{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(se`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(se`/evals/${n}/runs/${e}/output_items`,tU,{query:r,...s})}}class sZ extends t5{constructor(){super(...arguments),this.outputItems=new sG(this._client)}create(e,t,s){return this._client.post(se`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(se`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(se`/evals/${e}/runs`,tU,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(se`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(se`/evals/${n}/runs/${e}`,s)}}sZ.OutputItems=sG;class s0 extends t5{constructor(){super(...arguments),this.runs=new sZ(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(se`/evals/${e}`,t)}update(e,t,s){return this._client.post(se`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tU,{query:e,...t})}delete(e,t){return this._client.delete(se`/evals/${e}`,t)}}s0.Runs=sZ;class s1 extends t5{create(e,t){return this._client.post("/files",tz({body:e,...t},this._client))}retrieve(e,t){return this._client.get(se`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tU,{query:e,...t})}delete(e,t){return this._client.delete(se`/files/${e}`,t)}content(e,t){return this._client.get(se`/files/${e}/content`,{...t,headers:s$([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await e7(t),i=await this.retrieve(e),Date.now()-r>s)throw new eF({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class s2 extends t5{}class s4 extends t5{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class s3 extends t5{constructor(){super(...arguments),this.graders=new s4(this._client)}}s3.Graders=s4;class s6 extends t5{create(e,t,s){return this._client.getAPIList(se`/fine_tuning/checkpoints/${e}/permissions`,tW,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(se`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(se`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class s8 extends t5{constructor(){super(...arguments),this.permissions=new s6(this._client)}}s8.Permissions=s6;class s5 extends t5{list(e,t={},s){return this._client.getAPIList(se`/fine_tuning/jobs/${e}/checkpoints`,tU,{query:t,...s})}}class s9 extends t5{constructor(){super(...arguments),this.checkpoints=new s5(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(se`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tU,{query:e,...t})}cancel(e,t){return this._client.post(se`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(se`/fine_tuning/jobs/${e}/events`,tU,{query:t,...s})}pause(e,t){return this._client.post(se`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(se`/fine_tuning/jobs/${e}/resume`,t)}}s9.Checkpoints=s5;class s7 extends t5{constructor(){super(...arguments),this.methods=new s2(this._client),this.jobs=new s9(this._client),this.checkpoints=new s8(this._client),this.alpha=new s3(this._client)}}s7.Methods=s2,s7.Jobs=s9,s7.Checkpoints=s8,s7.Alpha=s3;class ne extends t5{}class nt extends t5{constructor(){super(...arguments),this.graderModels=new ne(this._client)}}nt.GraderModels=ne;class ns extends t5{createVariation(e,t){return this._client.post("/images/variations",tz({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tz({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class nn extends t5{retrieve(e,t){return this._client.get(se`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tW,e)}delete(e,t){return this._client.delete(se`/models/${e}`,t)}}class nr extends t5{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ni extends t5{accept(e,t,s){return this._client.post(se`/realtime/calls/${e}/accept`,{body:t,...s,headers:s$([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post(se`/realtime/calls/${e}/hangup`,{...t,headers:s$([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post(se`/realtime/calls/${e}/refer`,{body:t,...s,headers:s$([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post(se`/realtime/calls/${e}/reject`,{body:t,...s,headers:s$([{Accept:"*/*"},s?.headers])})}}class na extends t5{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class no extends t5{constructor(){super(...arguments),this.clientSecrets=new na(this._client),this.calls=new ni(this._client)}}function nl(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){let s=function(e,t){return e.find(e=>"function"===e.type&&e.name===t)}(e.tools??[],t.name);return{...t,...t,parsed_arguments:function(e){return e?.$brand==="auto-parseable-tool"}(s)?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,n;return"output_text"===e.type?{...e,parsed:(s=t,n=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(n):JSON.parse(n))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||nc(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}no.ClientSecrets=na,no.Calls=ni;function nc(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class nu extends su{constructor(e){super(),ef.add(this),em.set(this,void 0),eg.set(this,void 0),ey.set(this,void 0),eN(this,em,e,"f")}static createResponse(e,t,s){let n=new nu(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n,r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ej(this,ef,"m",ew).call(this);let i=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))ej(this,ef,"m",e_).call(this,r,i);if(n.controller.signal?.aborted)throw new eW;return ej(this,ef,"m",eb).call(this)}[(em=new WeakMap,eg=new WeakMap,ey=new WeakMap,ef=new WeakSet,ew=function(){this.ended||eN(this,eg,void 0,"f")},e_=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=ej(this,ef,"m",ev).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eB(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eB(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eB(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eB(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},eb=function(){if(this.ended)throw new eB("stream has ended, this shouldn't happen");let e=ej(this,eg,"f");if(!e)throw new eB("request ended without sending any events");eN(this,eg,void 0,"f");let t=function(e,t){var s;return t&&(s=t,sn(s.text?.format))?nl(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,ej(this,em,"f"));return eN(this,ey,t,"f"),t},ev=function(e){let t=ej(this,eg,"f");if(!t){if("response.created"!==e.type)throw new eB(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eN(this,eg,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eB(`missing output at index ${e.output_index}`);let n=s.type,r=e.part;"message"===n&&"reasoning_text"!==r.type?s.content.push(r):"reasoning"===n&&"reasoning_text"===r.type&&(s.content||(s.content=[]),s.content.push(r));break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eB(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eB(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eB(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eB(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.reasoning_text.delta":{let s=t.output[e.output_index];if(!s)throw new eB(`missing output at index ${e.output_index}`);if("reasoning"===s.type){let t=s.content?.[e.content_index];if(!t)throw new eB(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new eB(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":eN(this,eg,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=ej(this,ey,"f");if(!e)throw new eB("stream ended without producing a ChatCompletion");return e}}class nh extends t5{list(e,t={},s){return this._client.getAPIList(se`/responses/${e}/input_items`,tU,{query:t,...s})}}class nd extends t5{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class np extends t5{constructor(){super(...arguments),this.inputItems=new nh(this._client),this.inputTokens=new nd(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nc(e),e))}retrieve(e,t={},s){return this._client.get(se`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nc(e),e))}delete(e,t){return this._client.delete(se`/responses/${e}`,{...t,headers:s$([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>nl(t,e))}stream(e,t){return nu.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(se`/responses/${e}/cancel`,t)}}np.InputItems=nh,np.InputTokens=nd;class nf extends t5{create(e,t,s){return this._client.post(se`/uploads/${e}/parts`,tz({body:t,...s},this._client))}}class nm extends t5{constructor(){super(...arguments),this.parts=new nf(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(se`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(se`/uploads/${e}/complete`,{body:t,...s})}}nm.Parts=nf;let ng=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class ny extends t5{create(e,t,s){return this._client.post(se`/vector_stores/${e}/file_batches`,{body:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(se`/vector_stores/${n}/file_batches/${e}`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(se`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(se`/vector_stores/${n}/file_batches/${e}/files`,tU,{query:r,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=s$([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e7(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(a).map(l);return await ng(c),await this.createAndPoll(e,{file_ids:o})}}class nw extends t5{create(e,t,s){return this._client.post(se`/vector_stores/${e}/files`,{body:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(se`/vector_stores/${n}/files/${e}`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(se`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(se`/vector_stores/${e}/files`,tU,{query:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(se`/vector_stores/${n}/files/${e}`,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=s$([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e7(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(se`/vector_stores/${n}/files/${e}/content`,tW,{...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class n_ extends t5{constructor(){super(...arguments),this.files=new nw(this._client),this.fileBatches=new ny(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(se`/vector_stores/${e}`,{...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(se`/vector_stores/${e}`,{body:t,...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tU,{query:e,...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(se`/vector_stores/${e}`,{...t,headers:s$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(se`/vector_stores/${e}/search`,tW,{body:t,method:"post",...s,headers:s$([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}n_.Files=nw,n_.FileBatches=ny;class nb extends t5{create(e,t){return this._client.post("/videos",tV({body:e,...t},this._client))}retrieve(e,t){return this._client.get(se`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",tF,{query:e,...t})}delete(e,t){return this._client.delete(se`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(se`/videos/${e}/content`,{query:t,...s,headers:s$([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(se`/videos/${e}/remix`,tV({body:t,...s},this._client))}}class nv extends t5{constructor(){super(...arguments),ex.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");ej(this,ex,"m",eS).call(this,s);let r=s$([t]).values,i=ej(this,ex,"m",e$).call(this,r,"webhook-signature"),a=ej(this,ex,"m",e$).call(this,r,"webhook-timestamp"),o=ej(this,ex,"m",e$).call(this,r,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new e0("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new e0("Webhook timestamp is too old");if(l>c+n)throw new e0("Webhook timestamp is too new");let u=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(d)))return}catch{continue}throw new e0("The given webhook signature does not match the expected signature")}}ex=new WeakSet,eS=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},e$=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s};class nx{constructor({baseURL:e=sq("OPENAI_BASE_URL"),apiKey:t=sq("OPENAI_API_KEY"),organization:s=sq("OPENAI_ORG_ID")??null,project:n=sq("OPENAI_PROJECT_ID")??null,webhookSecret:r=sq("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(eA.add(this),eO.set(this,void 0),this.completions=new sJ(this),this.chat=new sx(this),this.embeddings=new sQ(this),this.files=new s1(this),this.images=new ns(this),this.audio=new sI(this),this.moderations=new nr(this),this.models=new nn(this),this.fineTuning=new s7(this),this.graders=new nt(this),this.vectorStores=new n_(this),this.webhooks=new nv(this),this.beta=new sX(this),this.batches=new sR(this),this.uploads=new nm(this),this.responses=new np(this),this.realtime=new no(this),this.conversations=new sY(this),this.evals=new s0(this),this.containers=new sV(this),this.videos=new nb(this),void 0===t)throw new eB("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let a={apiKey:t,organization:s,project:n,webhookSecret:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&tt())throw new eB("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??ek.DEFAULT_TIMEOUT,this.logger=a.logger??console;let o="warn";this.logLevel=o,this.logLevel=tA(a.logLevel,"ClientOptions.logLevel",this)??tA(sq("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eN(this,eO,tu,"f"),this._options=a,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return s$([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n,r=e,i=function(e=t_){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||t_.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=th;if(void 0!==e.format){if(!tf(tp,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tp[n],i=t_.filter;if(("function"==typeof e.filter||e4(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in ty?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":t_.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||t_.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:t_.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:t_.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:t_.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?t_.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:t_.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:t_.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:t_.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:t_.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:t_.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:t_.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:t_.strictNullHandling}}(t);"function"==typeof i.filter?r=(0,i.filter)("",r):e4(i.filter)&&(s=i.filter);let a=[];if("object"!=typeof r||null===r)return"";let o=ty[i.arrayFormat],l="comma"===o&&i.commaRoundTrip;s||(s=Object.keys(r)),i.sort&&s.sort(i.sort);let c=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];i.skipNulls&&null===r[t]||tw(a,function e(t,s,n,r,i,a,o,l,c,u,h,d,p,f,m,g,y,w){var _,b;let v,x=t,S=w,$=0,A=!1;for(;void 0!==(S=S.get(tb))&&!A;){let e=S.get(t);if($+=1,void 0!==e)if(e===$)throw RangeError("Cyclic object value");else A=!0;void 0===S.get(tb)&&($=0)}if("function"==typeof u?x=u(s,x):x instanceof Date?x=p?.(x):"comma"===n&&e4(x)&&(x=tg(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(a)return c&&!g?c(s,t_.encoder,y,"key",f):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,t_.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,t_.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let k=[];if(void 0===x)return k;if("comma"===n&&e4(x))g&&c&&(x=tg(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(e4(u))v=u;else{let e=Object.keys(x);v=h?e.sort(h):e}let O=l?String(s).replace(/\./g,"%2E"):String(s),I=r&&e4(x)&&1===x.length?O+"[]":O;if(i&&e4(x)&&0===x.length)return I+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,A=e4(x)?"function"==typeof n?n(I,S):I:I+(d?"."+S:"["+S+"]");w.set(t,$);let O=new WeakMap;O.set(tb,w),tw(k,e(b,A,n,r,i,a,o,l,"comma"===n&&g&&e4(x)?null:c,u,h,d,p,f,m,g,y,O))}return k}(r[t],t,o,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}let u=a.join(i.delimiter),h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${te}`}defaultIdempotencyKey(){return`stainless-node-retry-${eM()}`}makeStatusError(e,t,s,n){return eq.generate(e,t,s,n)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof eB)throw e;throw new eB(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new eB(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,s){let n=!ej(this,eA,"m",eI).call(this)&&s||this.baseURL,r=new URL(e2(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tD(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=await this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:a,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(tE(this).debug(`[${l}] sending request`,tP({retryOfRequestLogID:s,method:n.method,url:a,options:n,headers:i.headers})),n.signal?.aborted)throw new eW;let h=new AbortController,d=await this.fetchWithTimeout(a,i,o,h).catch(eD),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eW;let r=eL(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tE(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tE(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tP({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),this.retryRequest(n,t,s??l);if(tE(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tE(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tP({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),r)throw new eF;throw new eU({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-u}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await tc(d.body),tE(this).info(`${m} - ${e}`),tE(this).debug(`[${l}] response error (${e})`,tP({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tE(this).info(`${m} - ${r}`);let i=await d.text().catch(e=>eD(e).message),a=e9(i),o=a?void 0:i;throw tE(this).debug(`[${l}] response error (${r})`,tP({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,a,o,d.headers)}return tE(this).info(m),tE(this).debug(`[${l}] response start`,tP({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),{response:d,options:n,controller:h,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tq(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:i,...a}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,n){let r,i=n?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n?.get("retry-after");if(a&&!r){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await e7(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:i,defaultBaseURL:a}=s,o=this.buildURL(r,i,a);"timeout"in s&&e5("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),u=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let i=s$([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ti(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=s$([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:to(e)}:ej(this,eO,"f").call(this,{body:e,headers:s})}}ek=nx,eO=new WeakMap,eA=new WeakSet,eI=function(){return"https://api.openai.com/v1"!==this.baseURL},nx.OpenAI=ek,nx.DEFAULT_TIMEOUT=6e5,nx.OpenAIError=eB,nx.APIError=eq,nx.APIConnectionError=eU,nx.APIConnectionTimeoutError=eF,nx.APIUserAbortError=eW,nx.NotFoundError=eK,nx.ConflictError=eV,nx.RateLimitError=eY,nx.BadRequestError=eX,nx.AuthenticationError=eJ,nx.InternalServerError=eQ,nx.PermissionDeniedError=eH,nx.UnprocessableEntityError=ez,nx.InvalidWebhookSignatureError=e0,nx.toFile=t6,nx.Completions=sJ,nx.Chat=sx,nx.Embeddings=sQ,nx.Files=s1,nx.Images=ns,nx.Audio=sI,nx.Moderations=nr,nx.Models=nn,nx.FineTuning=s7,nx.Graders=nt,nx.VectorStores=n_,nx.Webhooks=nv,nx.Beta=sX,nx.Batches=sR,nx.Uploads=nm,nx.Responses=np,nx.Realtime=no,nx.Conversations=sY,nx.Evals=s0,nx.Containers=sV,nx.Videos=nb;let nS=(0,s(18824).createClient)("https://qcwtkyxvejcogbhbauey.supabase.co/",process.env.SUPABASE_SERVICE_ROLE_KEY),n$=new nx({apiKey:process.env.OPENAI_API_KEY});async function nA(){let e=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),t=`You are an expert market analyst and financial writer. Write a comprehensive, SEO-optimized blog post about today's market insights and trading opportunities.

Today's Date: ${e}

Requirements:
1. Write an engaging, informative blog post (800-1200 words)
2. Include current market trends, key sectors, and trading opportunities
3. Discuss volatility, sentiment, and potential catalysts
4. Provide actionable insights for options traders
5. Use markdown formatting with headers, lists, and emphasis
6. Include specific stock tickers and sectors
7. Write in a professional yet accessible tone

Format your response as JSON with the following structure:
{
  "title": "Compelling SEO-friendly title",
  "summary": "2-3 sentence summary for preview",
  "content": "Full blog post in markdown format",
  "tags": ["tag1", "tag2", "tag3"],
  "marketData": {
    "trend": "bullish|bearish|neutral",
    "sentiment": "positive|negative|mixed",
    "confidence": 0.75,
    "keyStocks": ["AAPL", "TSLA", "NVDA"],
    "sectors": ["Technology", "Energy"]
  }
}`,s=JSON.parse((await n$.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"You are an expert financial analyst and content writer. Always respond with valid JSON."},{role:"user",content:t}],temperature:.7,response_format:{type:"json_object"}})).choices[0].message.content||"{}");return{title:s.title,slug:s.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").substring(0,100),summary:s.summary,content:s.content,tags:s.tags||[],readingTime:Math.ceil(s.content.split(/\s+/).length/200),marketData:s.marketData||{}}}async function nk(e){try{if(e.headers.get("authorization")!==`Bearer ${process.env.CRON_SECRET}`)return eT.NextResponse.json({error:"Unauthorized"},{status:401});console.log("\uD83E\uDD16 Starting automated daily blog generation...");let t=await nA(),{data:s,error:n}=await nS.from("blog_posts").insert({title:t.title,slug:t.slug,content:t.content,summary:t.summary,author:"AI Market Analyst",reading_time:t.readingTime,tags:t.tags,meta_description:t.summary.substring(0,160),meta_keywords:t.tags,market_data:t.marketData,status:"published",published_at:new Date().toISOString()}).select().single();if(n)return console.error(" Error saving blog post:",n),eT.NextResponse.json({error:"Failed to save blog post",details:n.message},{status:500});return console.log(` Blog post published: "${s.title}" (ID: ${s.id})`),eT.NextResponse.json({success:!0,message:"Daily blog generated and published",post:{id:s.id,title:s.title,slug:s.slug,published_at:s.published_at}})}catch(e){return console.error(" Cron job failed:",e),eT.NextResponse.json({error:"Blog generation failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function nO(e){return nk(e)}let nI=new eE.AppRouteRouteModule({definition:{kind:eP.RouteKind.APP_ROUTE,page:"/api/cron/generate-daily-blog/route",pathname:"/api/cron/generate-daily-blog",filename:"route",bundlePath:"app/api/cron/generate-daily-blog/route"},resolvedPagePath:"/workspaces/virtual-options-desk/frontend/src/app/api/cron/generate-daily-blog/route.ts",nextConfigOutput:"standalone",userland:eR}),{workAsyncStorage:nR,workUnitAsyncStorage:nE,serverHooks:nP}=nI;function nC(){return(0,eC.patchFetch)({workAsyncStorage:nR,workUnitAsyncStorage:nE})}},11997:e=>{"use strict";e.exports=require("punycode")},15346:()=>{},24429:()=>{},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64749:()=>{},74075:e=>{"use strict";e.exports=require("zlib")},76947:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83622:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=83622,e.exports=t},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[9683,9146,8824],()=>s(11384));module.exports=n})();