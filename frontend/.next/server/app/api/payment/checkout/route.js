(()=>{var e={};e.id=8963,e.ids=[8963],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7730:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>p});var o=t(30781),a=t(60554),i=t(31625),n=t(96396),c=t(31344),u=t(80129);let l=(process.env.PAYMENT_API_URL||"http://localhost:3001").replace(/\/$/,"");async function p(e){try{let{planId:r}=await e.json();if(console.log("=== Checkout API Route ==="),console.log("Checkout request received for plan:",r),console.log("Payment API URL:",l),!r)return n.NextResponse.json({error:"Plan ID is required"},{status:400});let t=await (0,u.UL)(),s=(0,c.createServerClient)("https://qcwtkyxvejcogbhbauey.supabase.co/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",{cookies:{get:e=>t.get(e)?.value,set(){},remove(){}}}),{data:{user:o},error:a}=await s.auth.getUser();if(console.log("Auth check result:",{hasUser:!!o,userId:o?.id,email:o?.email,error:a?.message}),a||!o)return console.error("❌ Auth error:",a),n.NextResponse.json({error:"Auth session is missing. Please log in again."},{status:401});console.log("✅ User authenticated:",o.id,o.email);let i=`${l}/api/checkout/create`;console.log("Calling payment API:",i),console.log("Request payload:",{planId:r,userId:o.id,successUrl:"http://localhost:3000/success?session_id={CHECKOUT_SESSION_ID}",cancelUrl:"http://localhost:3000/pricing"});let p=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:r,userId:o.id,successUrl:"http://localhost:3000/success?session_id={CHECKOUT_SESSION_ID}",cancelUrl:"http://localhost:3000/pricing"})});if(console.log("Payment API response status:",p.status),!p.ok){let e,r=await p.text();console.error("❌ Payment API error:",p.status,r);try{e=JSON.parse(r),console.error("❌ Parsed error data:",e)}catch{e={error:r}}return n.NextResponse.json({error:e.error||"Failed to create checkout session",details:e.details||r,hint:"Check if Stripe price IDs are configured in payment API environment variables"},{status:p.status})}let d=await p.json();return console.log("Checkout session created successfully"),n.NextResponse.json(d)}catch(e){return console.error("Checkout error:",e),n.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:String(e)},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/payment/checkout/route",pathname:"/api/payment/checkout",filename:"route",bundlePath:"app/api/payment/checkout/route"},resolvedPagePath:"/workspaces/virtual-options-desk/frontend/src/app/api/payment/checkout/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:x,serverHooks:g}=d;function m(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},15346:()=>{},24429:()=>{},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64749:()=>{},74075:e=>{"use strict";e.exports=require("zlib")},76947:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83622:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=83622,e.exports=r},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9683,9146,8824,129,1344],()=>t(7730));module.exports=s})();