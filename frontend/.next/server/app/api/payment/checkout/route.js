(()=>{var e={};e.id=8963,e.ids=[8963],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19428:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>l});var o=t(80702),n=t(35095),a=t(12174),i=t(61439),c=t(35323),u=t(99380);let p=(process.env.PAYMENT_API_URL||"http://localhost:3001").replace(/\/$/,"");async function l(e){try{let{planId:r}=await e.json();if(console.log("=== Checkout API Route ==="),console.log("Checkout request received for plan:",r),console.log("Payment API URL:",p),!r)return i.NextResponse.json({error:"Plan ID is required"},{status:400});let t=await (0,u.UL)(),s=(0,c.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:e=>t.get(e)?.value,set(){},remove(){}}}),{data:{user:o},error:n}=await s.auth.getUser();if(console.log("Auth check result:",{hasUser:!!o,userId:o?.id,email:o?.email,error:n?.message}),n||!o)return console.error("❌ Auth error:",n),i.NextResponse.json({error:"Auth session is missing. Please log in again."},{status:401});console.log("✅ User authenticated:",o.id,o.email);let a=`${p}/api/checkout/create`;console.log("Calling payment API:",a),console.log("Request payload:",{planId:r,userId:o.id,successUrl:`${process.env.NEXT_PUBLIC_URL}/success?session_id={CHECKOUT_SESSION_ID}`,cancelUrl:`${process.env.NEXT_PUBLIC_URL}/pricing`});let l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:r,userId:o.id,successUrl:`${process.env.NEXT_PUBLIC_URL}/success?session_id={CHECKOUT_SESSION_ID}`,cancelUrl:`${process.env.NEXT_PUBLIC_URL}/pricing`})});if(console.log("Payment API response status:",l.status),!l.ok){let e,r=await l.text();console.error("❌ Payment API error:",l.status,r);try{e=JSON.parse(r),console.error("❌ Parsed error data:",e)}catch{e={error:r}}return i.NextResponse.json({error:e.error||"Failed to create checkout session",details:e.details||r,hint:"Check if Stripe price IDs are configured in payment API environment variables"},{status:l.status})}let d=await l.json();return console.log("Checkout session created successfully"),i.NextResponse.json(d)}catch(e){return console.error("Checkout error:",e),i.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:String(e)},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/payment/checkout/route",pathname:"/api/payment/checkout",filename:"route",bundlePath:"app/api/payment/checkout/route"},resolvedPagePath:"/workspaces/virtual-options-desk/frontend/src/app/api/payment/checkout/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:x,serverHooks:g}=d;function v(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:x})}},22408:()=>{},27910:e=>{"use strict";e.exports=require("stream")},28450:()=>{},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30305:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=30305,e.exports=r},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54451:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},58856:()=>{},59249:e=>{"use strict";e.exports=require("http")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5143,4352,6568,9380,5323],()=>t(19428));module.exports=s})();