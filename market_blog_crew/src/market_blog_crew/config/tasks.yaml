research_market_task:
  description: >
    Conduct comprehensive market research for today's date ({current_date}) using REAL-TIME web search tools.
    
    **IMPORTANT: You MUST use your SerperDevTool and WebsiteSearchTool to gather CURRENT data from today.**
    
    Search for and compile the following LIVE information:
    
    1. **Major Market Indices** (Search: "S&P 500 {current_date}", "Nasdaq {current_date}", "Dow Jones {current_date}")
       - Current levels and performance for S&P 500, Nasdaq, Dow Jones, Russell 2000
       - Search multiple financial websites (Yahoo Finance, MarketWatch, Bloomberg)
    
    2. **Economic Calendar** (Search: "economic calendar {current_date}", "market news {current_date}")
       - Today's economic data releases
       - Upcoming Fed meetings or policy announcements
       - Recent inflation/jobs/GDP reports
    
    3. **Sector Performance** (Search: "sector performance {current_date}", "best performing sectors {current_date}")
       - Which sectors are leading/lagging TODAY
       - Use live market data from financial websites
    
    4. **Top Market News** (Search: "market news {current_date}", "stock market breaking news {current_date}")
       - Breaking news affecting markets TODAY
       - Major earnings reports
       - Geopolitical events
    
    5. **Volatility Environment** (Search: "VIX {current_date}", "market volatility {current_date}")
       - Current VIX level
       - Market sentiment indicators
    
    6. **Notable Stock Movers** (Search: "biggest stock movers {current_date}", "stocks with high volume {current_date}")
       - Stocks with unusual activity TODAY
       - Major price movements
    
    7. **Commodities & Currencies** (Search: "gold price {current_date}", "oil price {current_date}", "dollar index {current_date}")
       - Current prices affecting risk sentiment
    
    8. **Market Sentiment** (Search: "market sentiment {current_date}", "fear and greed index {current_date}")
       - Investor mood and sentiment indicators
    
    **YOU MUST USE YOUR TOOLS** - Do not rely on training data. Search the web for current information.
    Use SerperDevTool for broad searches and WebsiteSearchTool for specific financial sites.
    

    Date: {current_date}

    After all metadata fields (TITLE, META_DESCRIPTION, TAGS, KEYWORDS, SP500_LEVEL, VIX_LEVEL, TOP_SECTOR), you MUST include a line that says exactly:
    CONTENT:
    and then write the full article content in markdown. Do not omit this marker. The parser will fail if CONTENT: is missing.

    IMPORTANT: FORMAT YOUR OUTPUT EXACTLY AS BELOW. DO NOT DEVIATE.
    If using a tool:
    Thought: [reasoning]
    Action: [tool name] [tool input]
    Example:
    Thought: I need to search for today's Dow Jones level.
    Action: SearchTool Dow Jones today

    If giving a final answer:
    Thought: I now can give a great answer
    Final Answer: [your best complete final answer to the task.]
    Example:
    Thought: I now can give a great answer
    Final Answer: The Dow Jones closed at 46,245.41 today according to Yahoo Finance.
  expected_output: >
    A detailed market intelligence report with 8 sections covering all requested areas.
    Include SPECIFIC CURRENT numbers, percentages, and dates from TODAY's market data.
    Cite sources (e.g., "According to Yahoo Finance at 2:30 PM EST...").
    Format as structured markdown with clear headers and bullet points. Minimum 800 words.
  agent: market_researcher

analyze_technicals_task:
  description: >
    Based on the market research provided, perform technical analysis on the most promising
    opportunities identified. For each asset/ticker, analyze:
    
     1. **Trend Analysis**: Is the asset in an uptrend, downtrend, or consolidation?
     2. **Chart Patterns**: Identify any bullish/bearish patterns (head & shoulders, triangles, flags, etc.)
     3. **Support & Resistance**: Key price levels where the asset might bounce or break
     4. **Technical Indicators**: 
       - RSI (oversold/overbought conditions)
       - MACD (momentum and trend direction)
       - Moving Averages (20, 50, 200-day crossovers)
       - Bollinger Bands (volatility and price extremes)
     5. **Volume Analysis**: Is volume confirming the price action?
     6. **Multiple Timeframes**: Validate signals across daily, weekly, monthly charts
     7. **Breakout/Breakdown Levels**: Specific price points that could trigger major moves
     8. **Current Price**: You MUST use the EODHDPriceTool to fetch the latest real-time price for each asset/ticker and cite it as the 'Current Price'.
    
    Focus on setups with high probability for options trades (strong trends, clear levels, momentum).
    Date: {current_date}

    IMPORTANT: FORMAT YOUR OUTPUT EXACTLY AS BELOW. DO NOT DEVIATE. For 'Current Price', always use the EODHDPriceTool and cite the value and timestamp.
    If using a tool:
    Thought: [reasoning]
    Action: [tool name] [tool input]
    Example:
    Thought: I need to analyze the RSI for AAPL.
    Action: TechnicalAnalysisTool RSI AAPL

    If giving a final answer:
    Thought: I now can give a great answer
    Final Answer: [your best complete final answer to the task.]
    Example:
    Thought: I now can give a great answer
    Final Answer: AAPL is showing a bullish RSI divergence and is likely to move higher.
  expected_output: >
    Technical analysis report covering 3-5 top opportunities. For each, provide specific
    price levels, indicator readings, and chart pattern analysis. Include entry zones,
    stop-loss levels, and price targets. Format as markdown with clear sections per asset.
    Minimum 600 words.
  agent: technical_analyst
  context:
    - research_market_task

identify_options_opportunities_task:
  description: >
    Using the market research and technical analysis, design specific options strategies
    for the top 2-3 opportunities. For each trade recommendation:
    
    1. **Underlying Asset & Rationale**: Why this specific stock/ETF/index?
    2. **Market Outlook**: Bullish, bearish, or neutral? Expected magnitude of move?
    3. **Strategy Selection**: 
       - Directional: Long call, long put, call/put spread
       - Volatility: Straddle, strangle, iron condor
       - Income: Covered call, cash-secured put
     4. **Specific Trade Details**:
       - Strike prices (specific numbers)
       - Expiration dates (provide actual dates, not just DTE)
       - Entry price range
       - Maximum profit potential ($ and %)
       - Maximum loss ($ and %)
       - **Current Price**: You MUST use the EODHDPriceTool to fetch the latest real-time price for each asset/ticker and cite it as the 'Current Price'.
    5. **Greeks Analysis**: Expected delta, theta decay, vega exposure
    6. **Probability of Profit**: Realistic assessment based on volatility
    7. **Exit Strategy**: When to take profits, when to cut losses, adjustment rules
    8. **Capital Requirements**: How much buying power needed per contract
    
    Ensure all strategies are practical for retail traders (liquid options, reasonable strikes).
    Date: {current_date}

    IMPORTANT: FORMAT YOUR OUTPUT EXACTLY AS BELOW. DO NOT DEVIATE.
    If using a tool:
    Thought: [reasoning]
    Action: [tool name] [tool input]
    Example:
    Thought: I need to check the implied volatility for TSLA options.
    Action: OptionsTool Implied Volatility TSLA

    If giving a final answer:
    Thought: I now can give a great answer
    Final Answer: [your best complete final answer to the task.]
    Example:
    Thought: I now can give a great answer
    Final Answer: The best strategy is a TSLA call spread with strikes at $250/$260 expiring Dec 15, 2025.
  expected_output: >
    Options strategy report with 2-3 detailed trade recommendations. Each recommendation
    must include all 8 elements listed above with specific numbers and dates. Format as
    markdown with clear sections per trade. Include a summary table of all trades.
    Minimum 800 words.
  agent: options_strategist
  context:
    - research_market_task
    - analyze_technicals_task

assess_risks_task:
  description: >
    Review all proposed options strategies and conduct rigorous risk assessment. For each trade:
    
    1. **Downside Scenario Analysis**: What happens if the market moves against us?
    2. **Maximum Loss Validation**: Confirm the stated max loss is accurate and acceptable
    3. **Position Sizing Recommendation**: What % of portfolio should this trade represent?
    4. **Correlation Risk**: Do multiple recommended trades have correlated risk?
    5. **Liquidity Check**: Are the options liquid enough to enter/exit without major slippage?
    6. **Volatility Risk**: Could IV crush hurt these positions after earnings/events?
    7. **Time Decay Risk**: Is theta working for or against us? How fast?
    8. **Black Swan Scenarios**: What unexpected events could cause catastrophic loss?
    9. **Risk/Reward Validation**: Is the potential reward worth the risk being taken?
    10. **Portfolio Heat**: If all trades go wrong, what's the total portfolio impact?
    
    Your job is to validate the strategies pass risk management standards OR identify
    necessary modifications (tighter stops, smaller size, different strikes, etc.).
    Be critical and thorough - capital preservation is paramount.
    Date: {current_date}

    IMPORTANT: FORMAT YOUR OUTPUT EXACTLY AS BELOW. DO NOT DEVIATE.
    If using a tool:
    Thought: [reasoning]
    Action: [tool name] [tool input]
    Example:
    Thought: I need to check the liquidity for the recommended options.
    Action: RiskTool Liquidity Check

    If giving a final answer:
    Thought: I now can give a great answer
    Final Answer: [your best complete final answer to the task.]
    Example:
    Thought: I now can give a great answer
    Final Answer: All trades have acceptable risk and are approved for execution.
  expected_output: >
    Risk assessment report covering all proposed trades. For each trade, provide:
    - Risk rating (Low/Medium/High)
    - Recommended position size (% of portfolio or $ amount)
    - Key risks and mitigation strategies
    - Final approval status (Approved / Approved with modifications / Rejected)
    If rejecting or modifying any trade, explain why and suggest alternatives.
    Format as markdown with clear sections. Minimum 500 words.
  agent: risk_manager
  context:
    - research_market_task
    - analyze_technicals_task
    - identify_options_opportunities_task

write_blog_post_task:
  description: >
    Transform all the research, technical analysis, options strategies, and risk assessment
    into a compelling, SEO-optimized blog post. The blog should:
    
    **Structure**:
    - Engaging headline (use power words, include key terms like "Options Strategy", "Market Analysis")
    - Meta description (155 characters, compelling summary)
    - Introduction (hook the reader, preview what they'll learn)
    - Market Overview section (synthesize market research into narrative)
    - Technical Analysis section (explain the setups in accessible language)
    - Options Trade Ideas section (present 2-3 strategies with all details)
    - Risk Management section (incorporate risk assessment findings)
    - Conclusion (recap key points, call-to-action)
    
    **SEO Requirements**:
    - Target keyword: "options trading strategy" or similar (use 3-5 times naturally)
    - Include related keywords: "market analysis", "technical indicators", "risk management"
    - Use H2 and H3 headers with keywords
    - Include bullet points and numbered lists for readability
    - Add internal link suggestions (e.g., [link to portfolio dashboard])
    
    **Style Guidelines**:
    - Write for intermediate traders (explain concepts but don't over-simplify)
    - Use specific numbers and data points from the research
    - Make it actionable - readers should know exactly what to do
    - Professional yet conversational tone
    - Include proper risk disclaimers
    - Length: 1800-2200 words
    
    **Output Format**:
    Output a structured blog post with clear sections separated by headers:

    TITLE: [Your engaging article title here]

    META_DESCRIPTION: [Your 155 character meta description here]

    TAGS: [Comma-separated tags like: options-trading, market-analysis, technical-analysis]

    KEYWORDS: [Comma-separated SEO keywords like: options trading strategy, market analysis, technical indicators]

    SP500_LEVEL: [Number like: 5321.45]

    VIX_LEVEL: [Number like: 14.85]

    TOP_SECTOR: [Sector name like: Technology]

    CONTENT:
    [Your full 1800-2200 word markdown article starts here...]

    Date: {current_date}

    IMPORTANT: FORMAT YOUR OUTPUT EXACTLY AS BELOW. DO NOT DEVIATE.
    Do NOT include any statements about how the content was generated, SEO formatting, or your process. Only output the blog post content itself, in the required format.

    If using a tool:
    Thought: [reasoning]
    Action: [tool name] [tool input]
    Example:
    Thought: I need to gather more market data for the blog post.
    Action: SearchTool Market Data Today

    If giving a final answer:
    Thought: I now can give a great answer
    Final Answer: [your best complete final answer to the task.]
    Example:
    Thought: I now can give a great answer
    Final Answer: [Full blog post content in required format.]
  expected_output: >
    A complete blog post with TITLE, META_DESCRIPTION, TAGS, KEYWORDS, market data (SP500_LEVEL, 
    VIX_LEVEL, TOP_SECTOR), and CONTENT sections clearly labeled. The content must be 1800-2200 words, 
    SEO-optimized, and professionally formatted with markdown headers, bullet points, and proper syntax.
  agent: content_writer
  context:
    - research_market_task
    - analyze_technicals_task
    - identify_options_opportunities_task
    - assess_risks_task
